<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ</title>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #faeeee 0%, #eefafa 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .map-container {
            position: relative;
            margin: 20px 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        #map {
            width: 100%;
            height: 400px;
            position: relative;
            z-index: 1;
        }
        
        .test-info {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            #map {
                height: 300px;
            }
            
            .test-info {
                padding: 15px;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Leaflet Ù„Ù„Ù‡Ø§ØªÙ */
        .leaflet-control-container {
            z-index: 1000 !important;
        }
        .leaflet-control {
            z-index: 1000 !important;
        }
        .leaflet-control-layers {
            z-index: 1000 !important;
        }
        .leaflet-control-layers-toggle {
            z-index: 1000 !important;
        }
        
        @media (max-width: 768px) {
            .leaflet-control {
                font-size: 14px !important;
            }
            .leaflet-control-layers {
                font-size: 14px !important;
                min-width: 120px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #2f6e73; margin-bottom: 30px;">
            ğŸ—ºï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„
        </h1>
        
        <div class="test-info">
            <h3>ğŸ“± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <div id="device-info" class="info">
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong> <span id="device-type">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</span></p>
                <p><strong>Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø©:</strong> <span id="screen-width">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</span></p>
                <p><strong>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø©:</strong> <span id="screen-height">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</span></p>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div class="test-info">
            <h3>ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <div id="test-results">
                <div class="info">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø£Ø²Ø±Ø§Ø±...</div>
            </div>
        </div>
        
        <div class="test-info">
            <h3>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <ol>
                <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (ğŸ“) ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø§Ù„Ø¹Ù„ÙˆÙŠØ©</li>
                <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø§Ù„Ø³ÙÙ„Ù‰</li>
                <li>Ø¬Ø±Ø¨ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„Ù‡Ø§</li>
                <li>Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</li>
            </ol>
        </div>
    </div>

    <script>
        // ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
        function updateDeviceInfo() {
            const deviceType = window.innerWidth <= 768 ? 'Ù‡Ø§ØªÙ Ù…Ø­Ù…ÙˆÙ„' : 'Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨';
            document.getElementById('device-type').textContent = deviceType;
            document.getElementById('screen-width').textContent = window.innerWidth + 'px';
            document.getElementById('screen-height').textContent = window.innerHeight + 'px';
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
        window.addEventListener('resize', updateDeviceInfo);
        updateDeviceInfo();
        
        // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Leaflet
        delete L.Icon.Default.prototype._getIconUrl;
        L.Icon.Default.mergeOptions({
            iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
            iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
        });
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        const map = L.map('map').setView([23.5880, 58.3829], 13);
        
        // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19,
        }).addTo(map);
        
        // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Â© Esri',
            maxZoom: 19,
        });
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
        const baseMaps = {
            "Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors',
                maxZoom: 19,
            }),
            "Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©": satelliteLayer
        };
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
        const layerControl = L.control.layers(baseMaps).addTo(map);
        
        // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ
        setTimeout(() => {
            const layerControlContainer = layerControl.getContainer();
            if (layerControlContainer) {
                layerControlContainer.style.zIndex = '1000';
                layerControlContainer.style.position = 'relative';
                
                if (window.innerWidth <= 768) {
                    layerControlContainer.style.fontSize = '14px';
                    layerControlContainer.style.padding = '8px';
                    layerControlContainer.style.borderRadius = '8px';
                    layerControlContainer.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                    layerControlContainer.style.minWidth = '120px';
                }
            }
        }, 100);
        
        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        const locationButton = L.control({ position: 'topright' });
        locationButton.onAdd = function () {
            const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
            div.innerHTML = `
                <button 
                    title="ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ"
                    style="
                        width: 44px; 
                        height: 44px; 
                        background-color: white; 
                        color: #374151; 
                        font-weight: bold; 
                        border: 2px solid #d1d5db; 
                        border-radius: 8px; 
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        font-size: 18px; 
                        cursor: pointer;
                        transition: all 0.2s ease;
                        z-index: 1000;
                    "
                    onmouseover="this.style.backgroundColor='#f3f4f6'; this.style.transform='scale(1.05)'"
                    onmouseout="this.style.backgroundColor='white'; this.style.transform='scale(1)'"
                >
                    ğŸ“
                </button>
            `;
            
            div.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                getCurrentLocation();
            };
            return div;
        };
        locationButton.addTo(map);
        
        // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø²Ø± Ù„Ù„Ù‡Ø§ØªÙ
        setTimeout(() => {
            const buttonElement = locationButton.getContainer()?.querySelector('button');
            if (buttonElement) {
                // Ø¥Ø¶Ø§ÙØ© touch events Ù„Ù„Ù‡Ø§ØªÙ
                buttonElement.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    buttonElement.style.backgroundColor = '#f3f4f6';
                    buttonElement.style.transform = 'scale(1.05)';
                });
                
                buttonElement.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    buttonElement.style.backgroundColor = 'white';
                    buttonElement.style.transform = 'scale(1)';
                });
                
                // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ù…ÙˆØ¶Ø¹ Ù„Ù„Ù‡Ø§ØªÙ
                if (window.innerWidth <= 768) {
                    buttonElement.style.width = '48px';
                    buttonElement.style.height = '48px';
                    buttonElement.style.fontSize = '20px';
                    buttonElement.style.borderRadius = '10px';
                    buttonElement.style.zIndex = '1000';
                    buttonElement.style.position = 'relative';
                }
                
                // ØªØ­Ø³ÙŠÙ† z-index Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£Ø¨
                const container = locationButton.getContainer();
                if (container) {
                    container.style.zIndex = '1000';
                    container.style.position = 'relative';
                }
            }
        }, 100);
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        map.setView([latitude, longitude], 16);
                        
                        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        const userMarker = L.marker([latitude, longitude], {
                            icon: L.divIcon({
                                className: 'user-location-marker',
                                html: '<div style="background-color: #4a8a8f; width: 16px; height: 16px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
                                iconSize: [16, 16],
                                iconAnchor: [8, 8]
                            })
                        }).addTo(map).bindPopup('Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ', {
                            closeButton: false,
                            closeOnClick: false
                        });
                        
                        updateTestResults('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­!');
                    },
                    (error) => {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error);
                        updateTestResults('error', 'ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                updateTestResults('error', 'Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.');
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function updateTestResults(type, message) {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        // ÙØ­Øµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        setTimeout(() => {
            const locationButtonContainer = locationButton.getContainer();
            const layerControlContainer = layerControl.getContainer();
            
            let results = [];
            
            if (locationButtonContainer && locationButtonContainer.querySelector('button')) {
                results.push('<div class="success">âœ… Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¸Ù‡Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</div>');
            } else {
                results.push('<div class="error">âŒ Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø§ ÙŠØ¸Ù‡Ø±</div>');
            }
            
            if (layerControlContainer) {
                results.push('<div class="success">âœ… Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ÙŠØ¸Ù‡Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</div>');
            } else {
                results.push('<div class="error">âŒ Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ù„Ø§ ÙŠØ¸Ù‡Ø±</div>');
            }
            
            if (window.innerWidth <= 768) {
                results.push('<div class="info">ğŸ“± ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„</div>');
            } else {
                results.push('<div class="info">ğŸ’» ÙˆØ¶Ø¹ Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨</div>');
            }
            
            document.getElementById('test-results').innerHTML = results.join('');
        }, 1000);
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨
        const marker = L.marker([23.5880, 58.3829], {
            draggable: true,
            icon: L.divIcon({
                className: 'custom-marker',
                html: '<div style="background-color: #b65449; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            })
        }).addTo(map);
        
        marker.bindPopup(`
            <div style="text-align: center; font-family: Calibri, Arial, sans-serif;">
                <div style="font-weight: bold; margin-bottom: 5px;">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ</div>
                <div style="font-size: 12px; color: #666;">
                    ${23.5880.toFixed(6)}, ${58.3829.toFixed(6)}
                </div>
            </div>
        `, {
            closeButton: false,
            closeOnClick: false
        });
        
        marker.on('dragend', (e) => {
            const { lat, lng } = e.target.getLatLng();
            marker.setPopupContent(`
                <div style="text-align: center; font-family: Calibri, Arial, sans-serif;">
                    <div style="font-weight: bold; margin-bottom: 5px;">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯</div>
                    <div style="font-size: 12px; color: #666;">
                        ${lat.toFixed(6)}, ${lng.toFixed(6)}
                    </div>
                </div>
            `);
        });
    </script>
</body>
</html>
